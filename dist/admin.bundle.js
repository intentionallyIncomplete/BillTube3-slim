BTFW.define("feature:channelThemeAdmin",[],async()=>{const e=(e,t=document)=>Array.from(t.querySelectorAll(e)),t="==BTFW_THEME_ADMIN_START==",n="=BTFW_THEME_ADMIN_END==",a="==BTFW_THEME_ADMIN_START==",o="==BTFW_THEME_ADMIN_END==",r=["#cs-jstext","#chanjs","#channel-js","#channeljs","#customjs","#customJS","textarea[name=chanjs]","textarea[name=channeljs]","textarea[data-setting='customJS']","textarea[data-setting='chanjs']","textarea[name='js']",".channel-js-field"],i=["#cs-csstext","#chancss","#channel-css","#channelcss","#customcss","#customCSS","textarea[name=chancss]","textarea[name=channelcss]","textarea[data-setting='customCSS']","textarea[data-setting='chancss']","textarea[name='css']",".channel-css-field"],s={version:7,tint:"midnight",colors:{background:"#0d0d0d",surface:"#090d15",panel:"#191b24",text:"#e8ecfb",chatText:"#d4defd",accent:"#191434"},slider:{enabled:!1,feedUrl:""},typography:{preset:"inter",customFamily:""},integrations:{enabled:!0,tmdb:{apiKey:""},ratings:{endpoint:""}},resources:{scripts:[],styles:[],modules:[]},branding:{headerName:"CyTube",faviconUrl:"",posterUrl:""}},l={midnight:{name:"Midnight Pulse",colors:{background:"#0d0d0d",surface:"#090d15",panel:"#191b24",text:"#e8ecfb",chatText:"#d4defd",accent:"#191434"}},aurora:{name:"Aurora Bloom",colors:{background:"#02121c",surface:"#071b28",panel:"#10273b",text:"#e9fbff",chatText:"#d0ebff",accent:"#4dd0f6"}},sunset:{name:"Sunset Neon",colors:{background:"#13030c",surface:"#1b0813",panel:"#26101d",text:"#ffe7f1",chatText:"#ffcade",accent:"#ff6b9d"}},ember:{name:"Ember Forge",colors:{background:"#110802",surface:"#190d05",panel:"#24140a",text:"#fbe3c9",chatText:"#f6cea3",accent:"#ff914d"}}},d=[400,500,600],c=d.join(";"),f={inter:{name:"Inter",family:"'Inter', 'Segoe UI', sans-serif",google:`Inter:wght@${c}`},roboto:{name:"Roboto",family:"'Roboto', 'Segoe UI', sans-serif",google:`Roboto:wght@${c}`},poppins:{name:"Poppins",family:"'Poppins', 'Segoe UI', sans-serif",google:`Poppins:wght@${c}`},montserrat:{name:"Montserrat",family:"'Montserrat', 'Segoe UI', sans-serif",google:`Montserrat:wght@${c}`},opensans:{name:"Open Sans",family:"'Open Sans', 'Segoe UI', sans-serif",google:`Open+Sans:wght@${c}`},lato:{name:"Lato",family:"'Lato', 'Segoe UI', sans-serif",google:`Lato:wght@${c}`},nunito:{name:"Nunito",family:"'Nunito', 'Segoe UI', sans-serif",google:`Nunito:wght@${c}`},manrope:{name:"Manrope",family:"'Manrope', 'Segoe UI', sans-serif",google:`Manrope:wght@${c}`},outfit:{name:"Outfit",family:"'Outfit', 'Segoe UI', sans-serif",google:`Outfit:wght@${c}`},urbanist:{name:"Urbanist",family:"'Urbanist', 'Segoe UI', sans-serif",google:`Urbanist:wght@${c}`}},u="inter",m=f[u].family,p="btfw-theme-font",b=`${p}-preload`,h=`${p}-preview`,g=[...d],w=new Map,y=new Map,v="btfw-theme-admin-style",x=new WeakMap,S=new Set;function _(e,t){const n=(e||[]).map(e=>"string"==typeof e?e:"").filter(e=>e.trim().length>0);if(0===n.length)return t?"\n":"";let a=n.join("\n\n");return t&&!a.endsWith("\n")&&(a+="\n"),a}function E(e){if("undefined"==typeof document)return;const t=document.getElementById(e);t?.parentElement?t.parentElement.removeChild(t):t?.remove?.()}function k(e,t,n){if("undefined"==typeof document||!document.head)return;if(!t)return void E(e);const a="style"===n?"href":"src",o=document.getElementById(e);if(o){const r=o.getAttribute(a)||"";if("style"===n&&"LINK"===o.tagName)return r===t||o.setAttribute(a,t),o;if("style"!==n&&"SCRIPT"===o.tagName&&r===t)return o;E(e)}if("style"===n){const n=document.createElement("link");return n.rel="stylesheet",n.href=t,n.id=e,document.head.appendChild(n),n}const r=document.createElement("script");return r.src=t,r.async=!0,r.defer=!0,r.id=e,document.head.appendChild(r),r}function C(e,t){if("undefined"==typeof document)return;Array.from(document.querySelectorAll(`[id^="${e}"]`)).forEach(e=>{const n=e.id.match(/(\d+)$/);if(!n)return;const a=Number(n[1]);Number.isNaN(a)||a<t||(e.parentElement?e.parentElement.removeChild(e):e.remove?.())})}function T(e){if(!e||"object"!=typeof e||"undefined"==typeof window)return null;const t=K(e),n=window.BTFW=window.BTFW||{};return window.BTFW_THEME_ADMIN=t,n.channelTheme=t,function(e){if(!e||"object"!=typeof e)return;const t=e.resources&&"object"==typeof e.resources?e.resources:{},n=Array.isArray(t.styles)?t.styles:[];n.forEach((e,t)=>k(`btfw-theme-style-${t}`,e,"style")),C("btfw-theme-style-",n.length);const a=Array.isArray(t.scripts)?t.scripts:[];a.forEach((e,t)=>k(`btfw-theme-script-${t}`,e,"script")),C("btfw-theme-script-",a.length);const o=q(F(e));o.forEach((e,t)=>k(`btfw-theme-module-${t}`,e,"script")),C("btfw-theme-module-",o.length),e.resources=e.resources||{},e.resources.styles=n.slice(),e.resources.scripts=a.slice(),e.resources.modules=o,"undefined"!=typeof window&&((window.BTFW=window.BTFW||{}).channelThemeModules=o.slice())}(t),function(e){if(!e||"object"!=typeof e)return;const t=e.slider&&"object"==typeof e.slider?e.slider:e.slider={};let n="boolean"==typeof t.enabled?t.enabled:e.sliderEnabled,a=t.feedUrl||t.url||e.sliderJson||"";if(n=Boolean(n),t.enabled=n,t.feedUrl=a,e.sliderEnabled=n,e.sliderJson=a,"undefined"!=typeof window){const e=window.BTFW=window.BTFW||{};e.channelSlider={enabled:n,feedUrl:a},e.channelSliderEnabled=n,e.channelSliderJSON=a}}(t),function(e){if(!e||"object"!=typeof e)return;const t=e.branding&&"object"==typeof e.branding?e.branding:e.branding={};let n="string"==typeof t.headerName?t.headerName.trim():"";n||"string"!=typeof e.headerName||(n=e.headerName.trim()),n||(n="CyTube"),t.headerName=n,["#nav-collapsible .navbar-brand",".navbar .navbar-brand",".navbar-brand","#navbrand"].forEach(e=>{const t=document?.querySelector?.(e);if(!t)return;let a=t.querySelector("[data-btfw-brand-text]");if(a)a.textContent=n;else{let e=!1;Array.from(t.childNodes||[]).forEach(t=>{if(t&&3===t.nodeType){if(!(t.textContent||"").trim())return;e?t.textContent="":(t.textContent=n,e=!0)}}),e||(a=document.createElement("span"),a.dataset.btfwBrandText="1",t.childNodes.length>0&&t.appendChild(document.createTextNode(" ")),a.textContent=n,t.appendChild(a))}t.setAttribute("title",n),t.setAttribute("aria-label",n)});let a="string"==typeof t.faviconUrl?t.faviconUrl.trim():"";if(a||"string"!=typeof t.favicon||(a=t.favicon.trim()),t.faviconUrl=a||"",t.favicon=t.faviconUrl,a&&"undefined"!=typeof document){const e='link[rel*="icon"], link[rel="shortcut icon"], link[rel="apple-touch-icon"]',t=Array.from(document.querySelectorAll(e));if(!t.length){const e=document.createElement("link");e.rel="icon",document.head?.appendChild(e),t.push(e)}t.forEach(e=>{try{e.href=a}catch(e){}})}let o="string"==typeof t.posterUrl?t.posterUrl.trim():"";o||"string"!=typeof e.branding?.posterUrl||(o=e.branding.posterUrl.trim()),t.posterUrl=o||"","undefined"!=typeof window&&((window.BTFW=window.BTFW||{}).channelPosterUrl=o||"")}(t),function(e){if(!e||"object"!=typeof e||"undefined"==typeof document)return;const t=e.colors&&"object"==typeof e.colors?e.colors:e.colors={},n=document.documentElement;if(!n)return;const a=t.background||"#05060d",o=t.surface||t.panel||"#0b111d",r=t.panel||"#141f36",i=t.text||"#e8ecfb",s=t.chatText||i,l=t.accent||"#6d4df6";t.background=a,t.surface=o,t.panel=r,t.text=i,t.chatText=s,t.accent=l;const d={"--btfw-theme-bg":a,"--btfw-theme-surface":o,"--btfw-theme-panel":r,"--btfw-theme-text":i,"--btfw-theme-chat-text":s,"--btfw-theme-accent":l};Object.keys(d).forEach(e=>{d[e]&&n.style.setProperty(e,d[e])}),n.setAttribute("data-btfw-theme-tint",e.tint||"custom");try{document.dispatchEvent(new CustomEvent("btfw:channelThemeTint",{detail:{tint:e.tint||"custom",colors:{bg:a,surface:o,panel:r,text:i,chat:s,accent:l},config:e}}))}catch(e){}}(t),function(e){if(!e||"object"!=typeof e)return;const t=e.integrations&&"object"==typeof e.integrations?e.integrations:e.integrations={};"boolean"!=typeof t.enabled&&(t.enabled=!0),t.tmdb&&"object"==typeof t.tmdb||(t.tmdb={apiKey:""});const n="string"==typeof t.tmdb.apiKey?t.tmdb.apiKey.trim():"";t.tmdb.apiKey=n,t.ratings&&"object"==typeof t.ratings||(t.ratings={endpoint:""});const a="string"==typeof t.ratings.endpoint?t.ratings.endpoint.trim():"";if(t.ratings.endpoint=a,"undefined"!=typeof window){if(window.BTFW_CONFIG=window.BTFW_CONFIG||{},"object"!=typeof window.BTFW_CONFIG.tmdb&&(window.BTFW_CONFIG.tmdb={}),window.BTFW_CONFIG.tmdb.apiKey=n,window.BTFW_CONFIG.tmdbKey=n,window.BTFW_CONFIG.integrationsEnabled=t.enabled,"object"!=typeof window.BTFW_CONFIG.ratings&&(window.BTFW_CONFIG.ratings={}),window.BTFW_CONFIG.ratings.endpoint=a,window.BTFW_CONFIG.ratingsEndpoint=a,window.BTFW_CONFIG.shouldLoadRatings=Boolean(a),a)window.BTFW_RATINGS_ENDPOINT=a;else try{delete window.BTFW_RATINGS_ENDPOINT}catch(e){window.BTFW_RATINGS_ENDPOINT=""}try{document?.body&&document.body.dataset.tmdbKey!==n&&(document.body.dataset.tmdbKey=n),document?.body&&(a?document.body.dataset.btfwRatingsEndpoint=a:document.body.dataset?.btfwRatingsEndpoint&&delete document.body.dataset.btfwRatingsEndpoint)}catch(e){}}}(t),function(e){if(!e||"object"!=typeof e)return;const t=e.typography&&"object"==typeof e.typography?e.typography:e.typography={},n=I(t,{scope:"runtime"});t.resolvedFamily=n.family}(t),t}function A(e){if(!e)return u;const t=String(e).trim().toLowerCase();return"custom"===t?"custom":t.replace(/[^a-z0-9]+/g,"")}function N(e){const t=A(e);return"custom"===t?null:f[t]||null}function j(e){const t=A(e?.preset||u),n="custom"===t,a=N(t)||N(u),o=(e?.customFamily||"").trim(),r=n&&o?`'${o.replace(/'/g,"\\'")}', ${m}`:a?.family||m;let i=a?.google?`https://fonts.googleapis.com/css2?family=${a.google}&display=swap`:"";return n&&o&&(i=function(e,t=null){if(!e)return"";const n=e.trim();return n?`https://fonts.googleapis.com/css2?family=${n.replace(/\s+/g,"+")}:wght@${t?Array.isArray(t)?t.join(";"):t:d.join(";")}&display=swap`:""}(o)),{preset:n?"custom":a?A(t):u,label:n&&o?o:a?.name||"Inter",family:r,url:i||""}}function L(e){if("undefined"==typeof document||!document.head)return Promise.resolve(null);const t=document.getElementById(h);if(!e)return t&&t.parentElement&&t.parentElement.removeChild(t),Promise.resolve(null);if(t&&t.getAttribute("href")===e){if("1"===t.dataset.btfwLoaded)return Promise.resolve(t);if(y.has(e))return y.get(e);const n=new Promise(e=>{const n=()=>e(t);t.addEventListener("load",()=>{t.dataset.btfwLoaded="1",n()},{once:!0}),t.addEventListener("error",n,{once:!0})});return y.set(e,n),n.then(t=>(y.delete(e),t),t=>{throw y.delete(e),t})}t&&t.parentElement&&t.parentElement.removeChild(t);const n=document.createElement("link");n.id=h,n.rel="stylesheet",n.dataset.btfwScope="preview";const a=new Promise(e=>{const t=()=>e(n);n.addEventListener("load",()=>{n.dataset.btfwLoaded="1",t()},{once:!0}),n.addEventListener("error",t,{once:!0})});return n.href=e,document.head.appendChild(n),y.set(e,a),a.then(t=>(y.delete(e),t),t=>{throw y.delete(e),t})}function M(e){if(!e)return;const t=e.url||"";if(!t)return L("");const n=function(e){return e?(String(e).split(",")[0]||"").replace(/['"]/g,"").trim():""}(e.family);if(!n)return L(t);const a=`${t}::${n}`;if(w.has(a))return w.get(a);const o=L(t).then(()=>function(e){if(!e||"undefined"==typeof document)return Promise.resolve(!1);const t=document.fonts;if(!t||"function"!=typeof t.load)return Promise.resolve(!1);if("function"==typeof t.check)try{if(t.check(`1rem "${e}"`))return Promise.resolve(!0)}catch(e){}const n=g.map(n=>{const a=`${n} 1rem "${e}"`;try{return t.load(a)}catch(n){try{return t.load(`1rem "${e}"`)}catch(e){return Promise.resolve()}}});return Promise.all(n).then(()=>!0).catch(()=>!1)}(n)).then(e=>e,e=>(console.warn(`[theme-admin] Failed to load preview font "${n}"`,e),w.delete(a),!1));return w.set(a,o),o}function I(e,t={}){const n=j(e),a="preview"===t.scope?"preview":"runtime",o=t.root||("undefined"!=typeof document?document.documentElement:null);if(o&&n.family&&o.style.setProperty("--btfw-theme-font-family",n.family),"preview"===a)M(n);else{const e=n.url||"";if(function(e,t){if("undefined"==typeof document||!document.head)return;let n=document.getElementById(e);t?(n||(n=document.createElement("link"),n.id=e,n.rel="preload",n.as="style",n.setAttribute("crossorigin","anonymous"),document.head.appendChild(n)),n.getAttribute("href")!==t&&n.setAttribute("href",t)):n&&n.parentElement&&n.parentElement.removeChild(n)}(b,e),function(e,t){if("undefined"==typeof document||!document.head)return;let n=document.getElementById(e);t?(n||(n=document.createElement("link"),n.id=e,n.rel="stylesheet",document.head.appendChild(n)),"stylesheet"!==n.rel&&(n.rel="stylesheet"),"anonymous"!==n.getAttribute("crossorigin")&&n.setAttribute("crossorigin","anonymous"),n.getAttribute("href")!==t&&n.setAttribute("href",t)):n&&n.parentElement&&n.parentElement.removeChild(n)}(p,e),"undefined"!=typeof document){const e=document.getElementById(h);e&&e.parentElement&&e.parentElement.removeChild(e)}}return n}function U(){return JSON.parse(JSON.stringify(s))}function O(e,t){if(!e||"object"!=typeof e)return e;if(Object.keys(e).forEach(t=>{delete e[t]}),!t||"object"!=typeof t)return e;const n=JSON.parse(JSON.stringify(t));return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function B(e){if("string"==typeof e)return e.trim();if(!e||"object"!=typeof e)return"";if(Array.isArray(e))return e.length?B(e[0]):"";for(const t of["url","href","src","value"])if("string"==typeof e[t])return e[t].trim();return""}function F(e){if(!e||"object"!=typeof e)return[];const t="function"==typeof WeakSet?new WeakSet:null,n=[],a=e=>{if(e&&"object"==typeof e){if(t){if(t.has(e))return;t.add(e)}Array.isArray(e)?e.forEach(e=>{e&&"object"==typeof e&&a(e)}):Object.keys(e).forEach(t=>{const o=e[t];/module/i.test(t)&&null!=o&&n.push(o),o&&"object"==typeof o&&a(o)})}};return a(e),n}function q(e){const t=[],n="function"==typeof WeakSet?new WeakSet:null,a=e=>{if(null!=e){if("string"==typeof e){const n=e.trim();return void(n&&t.push(n))}if(Array.isArray(e))e.forEach(e=>a(e));else if("object"==typeof e){if(n){if(n.has(e))return;n.add(e)}const o=B(e);o&&t.push(o);const r=["url","href","src","value"];Object.keys(e).forEach(t=>{o&&r.includes(t)||a(e[t])})}}};a(e);const o=[],r=new Set;return t.forEach(e=>{e&&!r.has(e)&&(r.add(e),o.push(e))}),o}function P(e){return e?e.querySelector('[data-role="module-inputs"]'):null}function $(e,t){const n=document.createElement("div");n.className="module-input__row";const a=document.createElement("input");return a.type="url",a.className="module-input__control",a.id=`btfw-theme-module-${e}`,a.name=`btfw-theme-module-${e}`,a.placeholder="https://example.com/module.js",a.dataset.role="module-input",a.value=t||"",n.appendChild(a),{wrapper:n,input:a}}function W(e,t,n){if(!e)return null;const{wrapper:a,input:o}=$(t,n);return e.appendChild(a),o}function J(e,t){const n=P(e);if(!n)return;const a=q(t),o=a.slice(0,10),r=[];o.forEach((e,t)=>{const{wrapper:n}=$(t,e);r.push(n)});let i=o.length;for(;i<3&&i<10;){const{wrapper:e}=$(i,"");r.push(e),i++}if(i<10&&a.length===o.length&&i===o.length){const{wrapper:e}=$(i,"");r.push(e)}"function"==typeof n.replaceChildren?n.replaceChildren(...r):(n.innerHTML="",r.forEach(e=>n.appendChild(e)))}function R(e){const t=P(e);if(!t)return;t.querySelectorAll(".module-input__row").forEach(e=>{e.querySelector('input[data-role="module-input"]')||e.remove()});let n=Array.from(t.querySelectorAll('input[data-role="module-input"]'));if(n.length||(J(e,[]),n=Array.from(t.querySelectorAll('input[data-role="module-input"]'))),n.length<3){let e=n.length;for(;e<3&&e<10;)W(t,e,""),e++;n=Array.from(t.querySelectorAll('input[data-role="module-input"]'))}!n.some(e=>!e.value.trim())&&n.length<10&&(W(t,n.length,""),n=Array.from(t.querySelectorAll('input[data-role="module-input"]'))),function(e){const t=P(e);if(!t)return;t.querySelectorAll(".module-input__row").forEach(e=>{e.querySelector('input[data-role="module-input"]')||e.remove()});let n=Array.from(t.querySelectorAll('input[data-role="module-input"]'));for(;n.length>3;){const e=n[n.length-1];if(e&&!e.value.trim()&&n.slice(0,n.length-1).some(e=>!e.value.trim())){const a=e.closest(".module-input__row");a&&a.parentElement===t?t.removeChild(a):e.remove(),n=Array.from(t.querySelectorAll('input[data-role="module-input"]'));continue}break}}(e)}function z(e,t){null!==t.timeoutId&&(clearTimeout(t.timeoutId),t.timeoutId=null),t.observer&&(t.observer.disconnect(),t.observer=null),S.delete(t),x.get(e)===t&&x.delete(e),e&&(delete e._btfwModuleHandlerBound,e.dataset&&e.dataset.btfwModuleWatcher&&delete e.dataset.btfwModuleWatcher)}function D(e,t){if(!e)return;const n=x.get(e);!n||t&&n!==t||(n.controller.signal.aborted?z(e,n):n.controller.abort())}function H(e,t){return t&&"object"==typeof t?(Object.keys(t).forEach(n=>{const a=t[n];a&&"object"==typeof a&&!Array.isArray(a)?e[n]=H(e[n]?{...e[n]}:{},a):e[n]=Array.isArray(a)?a.slice():a}),e):e}function G(e){if(!e)return null;const a=e.indexOf(t),o=e.indexOf(n);if(-1===a||-1===o||o<a)return null;const r=e.slice(a+26,o).trim().match(/window\.BTFW_THEME_ADMIN\s*=\s*(\{[\s\S]*?\});/);if(!r)return null;try{return JSON.parse(r[1])}catch(e){return console.warn("[theme-admin] Failed to parse stored config",e),null}}function K(e){const t=U(),n=U();H(n,e||{}),n.slider&&"object"==typeof n.slider||(n.slider=JSON.parse(JSON.stringify(t.slider)));const a=n.slider||{};n.sliderEnabled=Boolean(a.enabled),n.sliderJson=a.feedUrl||a.url||n.sliderJson||"",n.integrations&&"object"==typeof n.integrations||(n.integrations=JSON.parse(JSON.stringify(t.integrations))),"boolean"!=typeof n.integrations.enabled&&(n.integrations.enabled=!0),n.integrations.tmdb&&"object"==typeof n.integrations.tmdb?"string"!=typeof n.integrations.tmdb.apiKey?n.integrations.tmdb.apiKey="":n.integrations.tmdb.apiKey=n.integrations.tmdb.apiKey.trim():n.integrations.tmdb={apiKey:""},n.integrations.ratings&&"object"==typeof n.integrations.ratings?"string"!=typeof n.integrations.ratings.endpoint?n.integrations.ratings.endpoint="":n.integrations.ratings.endpoint=n.integrations.ratings.endpoint.trim():n.integrations.ratings={endpoint:""},n.features&&"object"==typeof n.features&&(delete n.features.videoOverlayPoll,0===Object.keys(n.features).length&&delete n.features),n.resources&&"object"==typeof n.resources||(n.resources=JSON.parse(JSON.stringify(t.resources))),Array.isArray(n.resources.styles)||(n.resources.styles=[]),Array.isArray(n.resources.scripts)||(n.resources.scripts=[]);const o=q(F(n));return n.resources.modules=o,delete n.resources.moduleUrls,delete n.resources.externalModules,delete n.moduleUrls,delete n.externalModules,delete n.modules,n.branding&&"object"==typeof n.branding||(n.branding=JSON.parse(JSON.stringify(t.branding))),"string"!=typeof n.branding.favicon||n.branding.faviconUrl||(n.branding.faviconUrl=n.branding.favicon),"string"!=typeof n.headerName||n.branding.headerName||(n.branding.headerName=n.headerName),"string"!=typeof n.branding.header||n.branding.headerName||(n.branding.headerName=n.branding.header),"string"!=typeof n.faviconUrl||n.branding.faviconUrl||(n.branding.faviconUrl=n.faviconUrl),"string"!=typeof n.posterUrl||n.branding.posterUrl||(n.branding.posterUrl=n.posterUrl),"string"!=typeof n.branding.posterUrl&&(n.branding.posterUrl=""),n.typography&&"object"==typeof n.typography||(n.typography=JSON.parse(JSON.stringify(t.typography))),n}function Q(e){const a=function(e){const t=JSON.parse(JSON.stringify(e||{}));return delete t.sliderEnabled,delete t.sliderJson,delete t.headerName,delete t.faviconUrl,delete t.posterUrl,t.branding&&"object"==typeof t.branding&&delete t.branding.favicon,t}(K(e)),o=JSON.stringify(a,null,2);return`${t}\nwindow.BTFW_THEME_ADMIN = ${o};\n${n}`}function V(e,t,n,a){const o=(a||"").trim();if(!o)return e;const r=e.indexOf(t),i=e.indexOf(n),s=/\n\s*$/.test(e);if(-1!==r&&-1!==i&&i>r){return _([e.slice(0,r).replace(/\s+$/,""),o,e.slice(i+n.length).replace(/^\s+/,"")],s)}const l=function(e){const t=e.indexOf("// BTFW_LOADER_SENTINEL");return-1===t?-1:e.lastIndexOf("\n",t)+1}(e);if(-1!==l){return _([e.slice(0,l).replace(/\s+$/,""),o,e.slice(l)],s)}const d=e.trim();return d?_([d,o],!0):o+"\n"}function Y(){try{if("function"==typeof window.hasPermission&&(window.hasPermission("motdedit")||window.hasPermission("seehidden")||window.hasPermission("chanowner")))return!0;const e=window.CLIENT||null;if(e?.hasPermission&&(e.hasPermission("motdedit")||e.hasPermission("seehidden")||e.hasPermission("chanowner")))return!0;if(e&&void 0!==e.rank){const t=0|e.rank,n=window.RANK||window.Ranks||{},a=[n.owner,n.founder,n.admin,n.administrator].find(e=>"number"==typeof e);return"number"==typeof a?t>=a:t>=4}}catch(e){}return!1}function X(e,t,n){for(const n of t){const t=e?e.querySelector(n):document.querySelector(n);if(t)return t}const a=e?.querySelector("form")||e?.querySelector(".modal-body")||e||document.body,o=document.createElement("textarea");return o.id=n,o.style.display="none",o.dataset.btfwThemeAdmin="synthetic",a.appendChild(o),o}function Z(e){if(!e)return null;const t=String(e).trim();return t?t.startsWith("#")?t.slice(1):/^[A-Za-z][\w:-]*$/.test(t)?t:null:null}function ee(e){if(!e)return{tabContainer:null,contentContainer:null};const t=e.querySelector(".nav-tabs, .modal-tabs, [role='tablist']"),n=e.querySelector(".tab-content, .modal-content .modal-body, .modal-body");return t&&!t.dataset.btfwTabsWired&&(t.dataset.btfwTabsWired="1",t.addEventListener("click",a=>{const o=a.target.closest("a[href^='#'], a[data-target^='#']");if(!o)return;const r=Z(o.getAttribute("data-target")||o.getAttribute("href")||"");if(!r)return;let i=document.getElementById(r);i&&!e.contains(i)&&(i=null),i&&(a.preventDefault(),function(e,t,n,a){if(!n||!e)return;Array.from(e.querySelectorAll("a[href^='#'], a[data-target^='#']")).forEach(e=>{const t=e.closest("li, [role='tab'], .tab")||e,o=Z(e.getAttribute("data-target")||e.getAttribute("href")||""),r=a?e===a:o&&o===n.id;t.classList.toggle("active",!!r),t.classList.toggle("is-active",!!r),t.setAttribute&&t.setAttribute("aria-selected",r?"true":"false"),e.classList.toggle("active",!!r),e.classList.toggle("is-active",!!r)});const o=t||n.parentElement;if(!o)return;Array.from(o.querySelectorAll(".tab-pane, [role='tabpanel'], .modal-tab, .tab-panel")).forEach(e=>{const t=e===n;e.classList.toggle("active",t),e.classList.toggle("is-active",t),e.classList.contains("tab-pane")&&e.classList.toggle("in",t),e.style.display=t?"block":"none",e.setAttribute&&e.setAttribute("aria-hidden",t?"false":"true")})}(t,n,i,o))},!0)),{tabContainer:t,contentContainer:n}}function te(e,t){const n=e.querySelector(".preview");if(!n)return;const a=t.colors||{},o=I(t.typography||{},{scope:"preview"});n.style.setProperty("--bg",a.background||"#05060d"),n.style.setProperty("--surface",a.surface||a.panel||"#0b111d"),n.style.setProperty("--panel",a.panel||"#141f36"),n.style.setProperty("--accent",a.accent||"#6d4df6"),n.style.background=`linear-gradient(160deg, ${a.background||"#05060d"}, ${a.surface||a.panel||"#0b111d"})`;const r=e.querySelector(".preview__accent");r&&(r.style.background=a.accent||"#6d4df6");e.querySelectorAll(".preview__chip").forEach(e=>{const t=e.dataset.key,n=a[t]||"#6d4df6";e.style.background=n,e.textContent=`${t.replace(/([A-Z])/g," $1")}: ${n}`});const i=e.querySelector(".preview--font");if(i){o.family&&(i.style.fontFamily=o.family);const e=i.querySelector('[data-role="font-name"]');e&&(e.textContent=o.label||"Inter");const t=i.querySelector('[data-role="font-sample"]');t&&(t.style.fontFamily=o.family||m)}}function ne(e){const t=e.querySelector("#btfw-theme-slider-enabled"),n=e.querySelector("#btfw-theme-slider-json");if(!t||!n)return;const a=Boolean(t.checked);n.disabled=!a;const o=n.closest(".field");o&&o.classList.toggle("is-disabled",!a)}function ae(e){const t=e.querySelector("#btfw-theme-font"),n=e.querySelector("#btfw-theme-font-custom-field"),a=e.querySelector("#btfw-theme-font-custom"),o="custom"===(t?.value||"").toLowerCase();a&&(a.disabled=!o),n&&n.classList.toggle("is-disabled",!o)}function oe(e){return function(){if(document.getElementById(v))return;const e=document.createElement("style");e.id=v,e.textContent='\n      .btfw-theme-admin {\n        --btfw-admin-surface: color-mix(in srgb, var(--btfw-theme-panel, #141f36) 92%, transparent 8%);\n        --btfw-admin-surface-alt: color-mix(in srgb, var(--btfw-theme-surface, #0b111d) 88%, transparent 12%);\n        --btfw-admin-border: color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 40%, transparent 60%);\n        --btfw-admin-border-soft: color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 26%, transparent 74%);\n        --btfw-admin-shadow: 0 20px 46px color-mix(in srgb, var(--btfw-theme-bg, #05060d) 55%, transparent 45%);\n        --btfw-admin-text: var(--btfw-theme-text, #dce4ff);\n        --btfw-admin-text-soft: color-mix(in srgb, var(--btfw-theme-text, #dce4ff) 72%, transparent 28%);\n        --btfw-admin-chip: color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 28%, transparent 72%);\n        padding: 18px 10px 28px;\n        color: var(--btfw-admin-text);\n        font-family: var(--btfw-font-body, \'Inter\', sans-serif);\n      }\n      .btfw-theme-admin h3 { font-size: 1.12rem; margin: 0 0 12px; letter-spacing: 0.04em; font-weight: 700; }\n      .btfw-theme-admin p.lead { margin: 0 0 18px; color: var(--btfw-admin-text-soft); max-width: 720px; }\n      .btfw-theme-admin details.section {\n        border-radius: 20px;\n        border: 1px solid var(--btfw-admin-border-soft);\n        margin-bottom: 18px;\n        background: linear-gradient(135deg, color-mix(in srgb, var(--btfw-admin-surface) 94%, transparent 6%), color-mix(in srgb, var(--btfw-admin-surface-alt) 88%, transparent 12%));\n        box-shadow: var(--btfw-admin-shadow);\n        overflow: hidden;\n        transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;\n      }\n      .btfw-theme-admin details.section[open] {\n        border-color: var(--btfw-admin-border);\n        box-shadow: 0 22px 52px color-mix(in srgb, var(--btfw-theme-bg, #05060d) 58%, transparent 42%);\n        background: linear-gradient(135deg, color-mix(in srgb, var(--btfw-admin-surface-alt) 96%, transparent 4%), color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 18%, transparent 82%));\n      }\n      .btfw-theme-admin summary.section__summary { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 18px 20px; cursor: pointer; list-style: none; }\n      .btfw-theme-admin summary.section__summary::-webkit-details-marker { display: none; }\n      .btfw-theme-admin .section__title { display: flex; flex-direction: column; gap: 4px; }\n      .btfw-theme-admin .section__title h4 { margin: 0; font-size: 0.95rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--btfw-admin-text); }\n      .btfw-theme-admin .section__title span { font-size: 0.84rem; color: var(--btfw-admin-text-soft); letter-spacing: 0.02em; }\n      .btfw-theme-admin .section__chevron { width: 28px; height: 28px; border-radius: 10px; border: 1px solid var(--btfw-admin-border-soft); display: inline-flex; align-items: center; justify-content: center; color: var(--btfw-admin-text-soft); font-size: 0.78rem; transition: transform 0.24s ease, border 0.18s ease, color 0.18s ease, background 0.18s ease; }\n      .btfw-theme-admin details.section[open] .section__chevron { transform: rotate(90deg); color: var(--btfw-admin-text); border-color: var(--btfw-admin-border); background: color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 14%, transparent 86%); }\n      .btfw-theme-admin .section__body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 16px; }\n      .btfw-theme-admin .field { display: flex; flex-direction: column; gap: 6px; }\n      .btfw-theme-admin label { font-weight: 600; letter-spacing: 0.03em; color: color-mix(in srgb, var(--btfw-admin-text) 92%, transparent 8%); }\n      .btfw-theme-admin .btfw-checkbox { display: inline-flex; gap: 10px; align-items: center; font-weight: 600; color: color-mix(in srgb, var(--btfw-admin-text) 92%, transparent 8%); }\n      .btfw-theme-admin .btfw-checkbox input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--btfw-theme-accent, #6d4df6); }\n      .btfw-theme-admin .field.is-disabled label,\n      .btfw-theme-admin .field.is-disabled .help { opacity: 0.55; }\n      .btfw-theme-admin .module-inputs { display: grid; gap: 10px; margin-top: 8px; }\n      .btfw-theme-admin .module-input__row { display: flex; }\n      .btfw-theme-admin .module-input__control { width: 100%; }\n      .btfw-theme-admin input[type="text"],\n      .btfw-theme-admin input[type="url"],\n      .btfw-theme-admin textarea,\n      .btfw-theme-admin select {\n        width: 100%;\n        background: color-mix(in srgb, var(--btfw-admin-surface-alt) 92%, transparent 8%);\n        border: 1px solid var(--btfw-admin-border-soft);\n        border-radius: 12px;\n        padding: 10px 12px;\n        color: color-mix(in srgb, var(--btfw-admin-text) 98%, white 2%);\n        font-size: 0.95rem;\n        box-shadow: inset 0 1px 0 color-mix(in srgb, var(--btfw-theme-bg, #05060d) 14%, transparent 86%);\n        transition: border 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;\n      }\n      .btfw-theme-admin input[type="text"]:focus,\n      .btfw-theme-admin input[type="url"]:focus,\n      .btfw-theme-admin textarea:focus,\n      .btfw-theme-admin select:focus { border-color: var(--btfw-theme-accent, #6d4df6); box-shadow: 0 0 0 2px color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 22%, transparent 78%); outline: none; }\n      .btfw-theme-admin .field.is-disabled input,\n      .btfw-theme-admin .field.is-disabled textarea,\n      .btfw-theme-admin .field.is-disabled select { opacity: 0.55; }\n      .btfw-theme-admin input[type="color"] { width: 100%; height: 44px; padding: 0; border-radius: 12px; border: 1px solid var(--btfw-admin-border); background: var(--btfw-admin-surface-alt); cursor: pointer; }\n      .btfw-theme-admin .help { font-size: 0.82rem; color: var(--btfw-admin-text-soft); line-height: 1.5; }\n      .btfw-theme-admin .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 14px; }\n      .btfw-theme-admin .preview { display: grid; grid-template-columns: minmax(0,1fr) auto; gap: 16px; padding: 18px; border-radius: 16px; background: linear-gradient(135deg, color-mix(in srgb, var(--btfw-admin-surface-alt) 94%, transparent 6%), color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 16%, transparent 84%)); box-shadow: inset 0 1px 0 color-mix(in srgb, var(--btfw-admin-border) 20%, transparent 80%); }\n      .btfw-theme-admin .preview__main { display: flex; flex-direction: column; gap: 10px; }\n      .btfw-theme-admin .preview__chips { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap: 8px; }\n      .btfw-theme-admin .preview__chip { padding: 10px; border-radius: 10px; background: var(--btfw-admin-chip); color: color-mix(in srgb, var(--btfw-admin-text) 96%, white 4%); font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.05em; }\n      .btfw-theme-admin .preview__accent { display: inline-flex; align-items: center; justify-content: center; padding: 10px 14px; border-radius: 999px; font-weight: 700; letter-spacing: 0.08em; color: color-mix(in srgb, var(--btfw-admin-text) 98%, white 2%); background: var(--btfw-theme-accent, #6d4df6); box-shadow: 0 10px 24px color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 32%, transparent 68%); }\n      .btfw-theme-admin .preview--font { padding: 18px; border-radius: 14px; background: color-mix(in srgb, var(--btfw-admin-surface) 96%, transparent 4%); border: 1px solid var(--btfw-admin-border-soft); box-shadow: inset 0 1px 0 color-mix(in srgb, var(--btfw-theme-bg, #05060d) 18%, transparent 82%); display: flex; flex-direction: column; gap: 8px; }\n      .btfw-theme-admin .preview__font-label { font-size: 0.82rem; text-transform: uppercase; letter-spacing: 0.04em; color: var(--btfw-admin-text-soft); }\n      .btfw-theme-admin .preview__font-text { font-size: 1rem; color: var(--btfw-admin-text); }\n      .btfw-theme-admin .buttons { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-top: 16px; }\n      .btfw-theme-admin .buttons .btn-primary,\n      .btfw-theme-admin .buttons .btn-secondary { padding: 10px 18px; border-radius: 12px; border: 0; font-weight: 600; letter-spacing: 0.02em; cursor: pointer; transition: transform 0.16s ease, filter 0.16s ease; }\n      .btfw-theme-admin .buttons .btn-primary { background: linear-gradient(135deg, color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 90%, white 10%), color-mix(in srgb, var(--btfw-theme-accent, #6d4df6) 68%, transparent 32%)); color: color-mix(in srgb, var(--btfw-admin-text) 98%, white 2%); }\n      .btfw-theme-admin .buttons .btn-secondary { background: color-mix(in srgb, var(--btfw-admin-surface-alt) 90%, transparent 10%); color: var(--btfw-admin-text); border: 1px solid var(--btfw-admin-border-soft); }\n      .btfw-theme-admin .buttons .btn-primary:hover,\n      .btfw-theme-admin .buttons .btn-secondary:hover { filter: brightness(1.05); transform: translateY(-1px); }\n      .btfw-theme-admin .buttons .btn-secondary:hover { border-color: var(--btfw-admin-border); }\n      .btfw-theme-admin .status { font-size: 0.82rem; color: var(--btfw-admin-text-soft); }\n      .btfw-theme-admin .integrations-callout { padding: 12px 14px; border-radius: 14px; background: color-mix(in srgb, var(--btfw-admin-surface-alt) 94%, transparent 6%); border: 1px dashed var(--btfw-admin-border-soft); display: flex; flex-direction: column; gap: 6px; font-size: 0.86rem; color: var(--btfw-admin-text-soft); }\n      .btfw-theme-admin .integrations-callout strong { color: var(--btfw-admin-text); }\n      @media (max-width: 720px) {\n        .btfw-theme-admin { padding: 14px 6px 24px; }\n        .btfw-theme-admin summary.section__summary { padding: 16px; }\n        .btfw-theme-admin .section__body { padding: 0 16px 16px; }\n        .btfw-theme-admin .grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }\n      }\n    ',document.head.appendChild(e)}(),e.innerHTML='\n      <div class="btfw-theme-admin">\n        <h3>Channel Theme Toolkit</h3>\n        <p class="lead">Configure your BillTube channel\'s featured media, theme palette, typography, and resources without editing raw Channel JS or CSS.</p>\n\n        <details class="section" data-section="resources">\n          <summary class="section__summary">\n            <div class="section__title">\n              <h4>Featured Content & Resources</h4>\n              <span>Manage the featured slider feed and extra theme assets.</span>\n            </div>\n            <span class="section__chevron" aria-hidden="true">></span>\n          </summary>\n          <div class="section__body">\n            <div class="field">\n              <label class="btfw-checkbox" for="btfw-theme-slider-enabled">\n                <input type="checkbox" id="btfw-theme-slider-enabled" data-btfw-bind="slider.enabled">\n                <span>Enable featured slider</span>\n              </label>\n              <p class="help">Toggles the channel list carousel by setting <code>UI_ChannelList</code> in Channel JS.</p>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-slider-json">Featured slider JSON</label>\n              <input type="url" id="btfw-theme-slider-json" data-btfw-bind="slider.feedUrl" placeholder="https://example.com/featured.json">\n              <p class="help">Paste the URL to the JSON feed used by the channel slider.</p>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-css-urls">Additional CSS URLs</label>\n              <textarea id="btfw-theme-css-urls" data-btfw-bind="resources.styles" placeholder="https://example.com/theme.css"></textarea>\n              <p class="help">Each line becomes a stylesheet link injected before the theme renders.</p>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-js-urls">Additional Script URLs</label>\n              <textarea id="btfw-theme-js-urls" data-btfw-bind="resources.scripts" placeholder="https://example.com/widget.js"></textarea>\n              <p class="help">Each line becomes a deferred script tag for optional widgets or behavior.</p>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-module-0">Additional module URLs</label>\n              <div class="module-inputs" data-role="module-inputs">\n                <div class="module-input__row">\n                  <input type="url" id="btfw-theme-module-0" name="btfw-theme-module-0" class="module-input__control" placeholder="https://example.com/module.js" data-role="module-input">\n                </div>\n                <div class="module-input__row">\n                  <input type="url" id="btfw-theme-module-1" name="btfw-theme-module-1" class="module-input__control" placeholder="https://example.com/module.js" data-role="module-input">\n                </div>\n                <div class="module-input__row">\n                  <input type="url" id="btfw-theme-module-2" name="btfw-theme-module-2" class="module-input__control" placeholder="https://example.com/module.js" data-role="module-input">\n                </div>\n              </div>\n              <p class="help">Load up to 10 extra BillTube modules by URL. A new field appears once you fill the last one.</p>\n            </div>\n          </div>\n        </details>\n\n        <details class="section" data-section="integrations">\n          <summary class="section__summary">\n            <div class="section__title">\n              <h4>Integrations</h4>\n              <span>Connect API keys used by chat tools and commands.</span>\n            </div>\n            <span class="section__chevron" aria-hidden="true">></span>\n          </summary>\n          <div class="section__body">\n            <div class="integrations-callout">\n              <strong>TMDB API key</strong>\n              <span>Required for the <code>!summary</code> command to fetch movie metadata. Request a key at <a href="https://www.themoviedb.org/settings/api" target="_blank" rel="noopener">themoviedb.org</a>.</span>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-integrations-tmdb">TMDB API key</label>\n              <input type="text" id="btfw-theme-integrations-tmdb" data-btfw-bind="integrations.tmdb.apiKey" placeholder="YOUR_TMDB_KEY">\n            </div>\n            <div class="integrations-callout">\n              <strong>Ratings API endpoint</strong>\n              <span>Point to your BillTube Worker that stores community ratings for now playing media.</span>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-integrations-ratings">Ratings API endpoint</label>\n              <input type="url" id="btfw-theme-integrations-ratings" data-btfw-bind="integrations.ratings.endpoint" placeholder="https://billtubemovierating.billtube.workers.dev/">\n              <p class="help">Leave blank to disable the rating widget entirely.</p>\n            </div>\n          </div>\n        </details>\n\n        <details class="section" data-section="palette">\n          <summary class="section__summary">\n            <div class="section__title">\n              <h4>Palette & Tint</h4>\n              <span>Adjust surface colors and accent tint.</span>\n            </div>\n            <span class="section__chevron" aria-hidden="true">></span>\n          </summary>\n          <div class="section__body">\n            <div class="field">\n              <label for="btfw-theme-tint">Preset tint</label>\n              <select id="btfw-theme-tint" data-btfw-bind="tint">\n                <option value="midnight">Midnight Pulse</option>\n                <option value="aurora">Aurora Bloom</option>\n                <option value="sunset">Sunset Neon</option>\n                <option value="ember">Ember Forge</option>\n                <option value="custom">Custom mix</option>\n              </select>\n              <p class="help">Choose a curated palette to start from, then fine-tune any swatch.</p>\n            </div>\n            <div class="grid">\n              <div class="field">\n                <label>Background</label>\n                <input type="color" data-btfw-bind="colors.background">\n              </div>\n              <div class="field">\n                <label>Surface</label>\n                <input type="color" data-btfw-bind="colors.surface">\n              </div>\n              <div class="field">\n                <label>Panel</label>\n                <input type="color" data-btfw-bind="colors.panel">\n              </div>\n              <div class="field">\n                <label>Primary text</label>\n                <input type="color" data-btfw-bind="colors.text">\n              </div>\n              <div class="field">\n                <label>Chat text</label>\n                <input type="color" data-btfw-bind="colors.chatText">\n              </div>\n              <div class="field">\n                <label>Accent</label>\n                <input type="color" data-btfw-bind="colors.accent">\n              </div>\n            </div>\n            <div class="preview" aria-hidden="true">\n              <div class="preview__main">\n                <div class="preview__chips">\n                  <div class="preview__chip" data-key="background"></div>\n                  <div class="preview__chip" data-key="surface"></div>\n                  <div class="preview__chip" data-key="panel"></div>\n                  <div class="preview__chip" data-key="text"></div>\n                  <div class="preview__chip" data-key="chatText"></div>\n                </div>\n              </div>\n              <div class="preview__accent">Accent</div>\n            </div>\n          </div>\n        </details>\n\n        <details class="section" data-section="typography">\n          <summary class="section__summary">\n            <div class="section__title">\n              <h4>Typography</h4>\n              <span>Select the base font used across the theme.</span>\n            </div>\n            <span class="section__chevron" aria-hidden="true">></span>\n          </summary>\n          <div class="section__body">\n            <div class="field">\n              <label for="btfw-theme-font">Font preset</label>\n              <select id="btfw-theme-font" data-btfw-bind="typography.preset">\n                <option value="inter">Inter</option>\n                <option value="roboto">Roboto</option>\n                <option value="poppins">Poppins</option>\n                <option value="montserrat">Montserrat</option>\n                <option value="opensans">Open Sans</option>\n                <option value="lato">Lato</option>\n                <option value="nunito">Nunito</option>\n                <option value="manrope">Manrope</option>\n                <option value="outfit">Outfit</option>\n                <option value="urbanist">Urbanist</option>\n                <option value="custom">Custom Google Font</option>\n              </select>\n              <p class="help">Curated Google Fonts optimized for readability. Choose <em>Custom</em> to specify your own.</p>\n            </div>\n            <div class="field" id="btfw-theme-font-custom-field">\n              <label for="btfw-theme-font-custom">Custom Google font name</label>\n              <input type="text" id="btfw-theme-font-custom" data-btfw-bind="typography.customFamily" placeholder="Space Grotesk">\n              <p class="help">Enter the exact family name from Google Fonts. We load weights 300, 400, 600, and 700 automatically.</p>\n            </div>\n            <div class="preview preview--font" aria-hidden="true">\n              <div class="preview__font-label" data-role="font-name">Inter</div>\n              <p class="preview__font-text" data-role="font-sample">The quick brown fox jumps over the lazy dog.</p>\n            </div>\n          </div>\n        </details>\n\n        <details class="section" data-section="branding">\n          <summary class="section__summary">\n            <div class="section__title">\n              <h4>Branding</h4>\n              <span>Navbar title, favicon, and poster overrides.</span>\n            </div>\n            <span class="section__chevron" aria-hidden="true">></span>\n          </summary>\n          <div class="section__body">\n            <div class="field">\n              <label for="btfw-theme-header-name">Channel header name</label>\n              <input type="text" id="btfw-theme-header-name" data-btfw-bind="branding.headerName" placeholder="CyTube">\n              <p class="help">Replaces the navbar brand text for all visitors.</p>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-favicon">Favicon URL</label>\n              <input type="url" id="btfw-theme-favicon" data-btfw-bind="branding.faviconUrl" placeholder="https://example.com/favicon.png">\n              <p class="help">Provide a full URL to the icon browsers should show in the tab bar.</p>\n            </div>\n            <div class="field">\n              <label for="btfw-theme-poster">Video poster URL</label>\n              <input type="url" id="btfw-theme-poster" data-btfw-bind="branding.posterUrl" placeholder="https://example.com/poster.jpg">\n              <p class="help">Optional hero image used by some overlays. Leave blank to use the default poster.</p>\n            </div>\n          </div>\n        </details>\n\n        <div class="buttons">\n          <button type="button" class="btn-primary" id="btfw-theme-apply">Apply to Channel CSS &amp; JS</button>\n          <button type="button" class="btn-secondary" id="btfw-theme-reset">Reset to preset</button>\n          <span class="status" id="btfw-theme-status" data-variant="idle">No changes applied yet.</span>\n        </div>\n      </div>\n    ',e}function re(t,n,a){e("[data-btfw-bind]",t).forEach(e=>{const n=()=>{if(e.dataset.btfwBind.startsWith("colors")){const e=t.querySelector("#btfw-theme-tint");e&&"custom"!==e.value&&(e.value="custom")}if("btfw-theme-slider-enabled"===e.id&&ne(t),e.dataset.btfwBind.startsWith("typography")){if("btfw-theme-font-custom"===e.id){const e=t.querySelector("#btfw-theme-font");e&&"custom"!==e.value&&(e.value="custom")}ae(t)}a()};e.addEventListener("input",n),e.addEventListener("change",n)});const o=t.querySelector("#btfw-theme-tint");o&&o.addEventListener("change",()=>{const e=o.value;if(e&&"custom"!==e&&l[e]){const a=l[e];Object.assign(n.colors,a.colors),ie(t,n)}ae(t),a()}),function(e,t){const n=P(e);if(!n)return void console.warn("[theme-admin] Module container not found for binding");D(n);const a=new AbortController,o={container:n,controller:a,timeoutId:null,observer:null};x.set(n,o),S.add(o),a.signal.addEventListener("abort",()=>{x.get(n)===o&&z(n,o)});const r=n=>{"module-input"===n?.target?.dataset?.role&&(null!==o.timeoutId&&clearTimeout(o.timeoutId),o.timeoutId=setTimeout(()=>{a.signal.aborted||(R(e),"function"==typeof t&&t()),o.timeoutId=null},10))};n.addEventListener("input",r,{signal:a.signal}),n.addEventListener("change",r,{signal:a.signal});const i=new MutationObserver(t=>{for(const a of t)for(const t of a.removedNodes)if(t===e||t===n||"function"==typeof t?.contains&&(t.contains(e)||t.contains(n)))return void D(n,o)});o.observer=i,i.observe(document.body,{childList:!0,subtree:!0}),n._btfwModuleHandlerBound=!0,n.dataset&&(n.dataset.btfwModuleWatcher="1")}(t,a);const r=t.querySelector("#btfw-theme-reset");r&&r.addEventListener("click",()=>{const e=t.querySelector("#btfw-theme-tint")?.value||"midnight";if("custom"!==e&&l[e]){const t=l[e];Object.assign(n.colors,t.colors)}else{const e=U();Object.assign(n.colors,e.colors)}ie(t,n),a()})}function ie(t,n){e("[data-btfw-bind]",t).forEach(e=>{const t=e.dataset.btfwBind;let a=n;t.split(".").forEach(e=>{a&&(a=a[e])}),"checkbox"===e.type?e.checked=Boolean(a):"TEXTAREA"===e.tagName?Array.isArray(a)?e.value=a.join("\n"):e.value=a||"":"color"===e.type?e.value=a||"#000000":e.value=a??""});const a=document.documentElement;a&&(a.classList.add("btfw-poll-overlay-enabled"),a.classList.remove("btfw-poll-overlay-disabled"));J(t,q(F(n))),R(t),ae(t),ne(t),te(t,n)}function se(t,n){const a=U();H(a,n),e("[data-btfw-bind]",t).forEach(e=>{const t=e.dataset.btfwBind;let n;if("checkbox"===e.type)n=e.checked;else if("TEXTAREA"===e.tagName){n=e.value.split(/\r?\n/).map(e=>e.trim()).filter(Boolean)}else n=e.value,"string"==typeof n&&(n=n.trim());!function(e,t,n){const a=t.split(".");let o=e;for(let e=0;e<a.length-1;e++){const t=a[e];o[t]&&"object"==typeof o[t]||(o[t]={}),o=o[t]}o[a[a.length-1]]=n}(a,t,n)}),a.resources&&"object"==typeof a.resources||(a.resources=U().resources),a.resources.modules=q(function(e){const t=P(e);if(!t)return[];const n=new Set,a=[];return t.querySelectorAll('input[data-role="module-input"]').forEach(e=>{const t=(e.value||"").trim();t&&!n.has(t)&&(n.add(t),a.push(t))}),a}(t)),delete a.resources.moduleUrls,delete a.resources.externalModules,delete a.moduleUrls,delete a.externalModules,a.slider&&"object"==typeof a.slider||(a.slider=U().slider),a.sliderEnabled=Boolean(a.slider?.enabled),a.sliderJson=a.slider?.feedUrl||"",a.integrations&&"object"==typeof a.integrations||(a.integrations=U().integrations),"boolean"!=typeof a.integrations.enabled&&(a.integrations.enabled=!0),a.integrations.tmdb&&"object"==typeof a.integrations.tmdb||(a.integrations.tmdb={apiKey:""}),a.integrations.tmdb.apiKey=(a.integrations.tmdb.apiKey||"").trim(),a.integrations.ratings&&"object"==typeof a.integrations.ratings||(a.integrations.ratings={endpoint:""}),"string"!=typeof a.integrations.ratings.endpoint?a.integrations.ratings.endpoint="":a.integrations.ratings.endpoint=a.integrations.ratings.endpoint.trim(),a.features&&"object"==typeof a.features&&(delete a.features.videoOverlayPoll,0===Object.keys(a.features).length&&delete a.features),a.typography&&"object"==typeof a.typography||(a.typography=U().typography),a.branding&&"object"==typeof a.branding||(a.branding=U().branding),"string"!=typeof a.branding.headerName&&(a.branding.headerName=""),"string"!=typeof a.branding.faviconUrl&&(a.branding.faviconUrl=""),"string"!=typeof a.branding.posterUrl&&(a.branding.posterUrl=""),a.headerName=a.branding.headerName,a.faviconUrl=a.branding.faviconUrl,a.posterUrl=a.branding.posterUrl;const o=a.typography||{};return o.preset=A(o.preset||u),"custom"!==o.preset?o.customFamily="":o.customFamily=(o.customFamily||"").trim(),a.typography={preset:o.preset,customFamily:o.customFamily||""},a.branding&&"object"==typeof a.branding||(a.branding=U().branding),"string"!=typeof a.branding.favicon||a.branding.faviconUrl||(a.branding.faviconUrl=a.branding.favicon),a.branding.favicon=a.branding.faviconUrl||"",a.branding.posterUrl=(a.branding.posterUrl||"").trim(),a.branding.headerName=(a.branding.headerName||"").trim(),a.version=s.version,a}function le(e,s,l,d={}){const c=d.mode||"manual",f=e.querySelector("#btfw-theme-status"),u=X(l,r,"chanjs"),p=X(l,i,"chancss");if(!u||!p)return void(f&&(f.textContent="Could not find Channel JS or CSS fields.",f.dataset.variant="error"));const b=u.value||"",h=p.value||"",g=se(e,s),w=Q(g),y=function(e){const t=e.colors||{},n=j(e.typography||{}),r=t.background||"#05060d",i=t.surface||t.panel||"#0b111d",s=t.panel||"#141f36",l=t.text||"#e8ecfb",d=t.chatText||l,c=t.accent||"#6d4df6",f=n.family||m;return`\n${a}\n:root {\n  --btfw-theme-bg: ${r};\n  --btfw-theme-surface: ${i};\n  --btfw-theme-panel: ${s};\n  --btfw-theme-text: ${l};\n  --btfw-theme-chat-text: ${d};\n  --btfw-theme-accent: ${c};\n  --btfw-theme-font-family: ${f};\n}\n${o}`}(g),v=function(e){const t="string"==typeof e?e:"";if(!t)return"";const n=t.split(/\r?\n/),a=[];for(let e=0;e<n.length;e++){const t=n[e],o=t.trim();/^(?:var|let|const)?\s*UI_ChannelList\s*=/.test(o)||/^window\.UI_ChannelList\s*=/.test(o)||/^(?:var|let|const)?\s*Channel_JSON\s*=/.test(o)||/^window\.Channel_JSON\s*=/.test(o)||a.push(t)}for(;a.length&&""===a[0].trim();)a.shift();for(let e=a.length-1;e>0;e--)""===a[e].trim()&&""===a[e-1].trim()&&a.splice(e,1);return a.join("\n")}(b);u.value=V(v,t,n,w),p.value=V(h,a,o,y),["input","change"].forEach(e=>{try{u.dispatchEvent(new Event(e,{bubbles:!0}))}catch(e){}try{p.dispatchEvent(new Event(e,{bubbles:!0}))}catch(e){}});const x=T(g)||g;return f&&("manual"===c?(f.textContent="Theme JS & CSS applied. Submitting changes...",f.dataset.variant="pending"):"init"===c&&(f.textContent="BillTube theme prepared. Click apply to submit changes.",f.dataset.variant="idle")),te(e,x),{config:x,jsField:u,cssField:p}}function de(e){if(!Y())return!1;const l=function(e){if(!e)return null;const{tabContainer:t,contentContainer:n}=ee(e),a=n||e.querySelector(".tab-content")||e;let o=a?.querySelector("#btfw-theme-admin-panel");if(o)return o;if(!t||!a)return null;let r=t.querySelector("li[data-btfw-theme-tab]");if(!r){const e=t.querySelector("a[href='#btfw-theme-admin-panel'], a[data-target='#btfw-theme-admin-panel']");if(e)r=e.closest("li")||e,r.dataset.btfwThemeTab="1";else if("UL"===t.tagName||"OL"===t.tagName||t.classList.contains("nav-tabs")){r=document.createElement("li"),r.dataset.btfwThemeTab="1";const e=document.createElement("a");e.href="#btfw-theme-admin-panel",e.setAttribute("data-toggle","tab"),e.innerHTML='<span class="fa fa-magic"></span> <span>Theme</span>',e.style.display="flex",e.style.alignItems="center",e.style.gap="8px",r.appendChild(e),t.appendChild(r)}else{const e=document.createElement("a");e.href="#btfw-theme-admin-panel",e.setAttribute("data-toggle","tab"),e.className="btfw-theme-tab-toggle",e.innerHTML='<span class="fa fa-magic"></span> <span>Theme</span>',t.appendChild(e),r=e}}return o=document.createElement("div"),o.id="btfw-theme-admin-panel",o.className="tab-pane",o.setAttribute("role","tabpanel"),o.style.display="none",a.appendChild(o),o}(e);if(!l||"1"===l.dataset.initialized)return Boolean(l);oe(l);const d=X(e,r,"chanjs"),c=X(e,i,"chancss"),f=G(d?.value||""),u=H(U(),f||{}),m=Number(u.version)||0;u.version=s.version,u.slider&&"object"==typeof u.slider||(u.slider=U().slider),"boolean"==typeof u.sliderEnabled&&(u.slider.enabled=u.sliderEnabled),"string"!=typeof u.sliderJson||u.slider.feedUrl||(u.slider.feedUrl=u.sliderJson),u.integrations&&"object"==typeof u.integrations||(u.integrations=U().integrations),"boolean"!=typeof u.integrations.enabled&&(u.integrations.enabled=!0),u.integrations.tmdb&&"object"==typeof u.integrations.tmdb||(u.integrations.tmdb={apiKey:""}),u.integrations.ratings&&"object"==typeof u.integrations.ratings||(u.integrations.ratings={endpoint:""}),u.branding&&"object"==typeof u.branding||(u.branding=U().branding),"string"!=typeof u.branding.favicon||u.branding.faviconUrl||(u.branding.faviconUrl=u.branding.favicon),"string"!=typeof u.headerName||u.branding.headerName||(u.branding.headerName=u.headerName),"string"!=typeof u.branding.header||u.branding.headerName||(u.branding.headerName=u.branding.header),"string"!=typeof u.faviconUrl||u.branding.faviconUrl||(u.branding.faviconUrl=u.faviconUrl),"string"!=typeof u.posterUrl||u.branding.posterUrl||(u.branding.posterUrl=u.posterUrl),"string"!=typeof u.branding.posterUrl&&(u.branding.posterUrl=""),u.resources&&"object"==typeof u.resources||(u.resources=U().resources),Array.isArray(u.resources.styles)||(u.resources.styles=[]),Array.isArray(u.resources.scripts)||(u.resources.scripts=[]);const p=q(F(u));u.resources.modules=p,delete u.resources.moduleUrls,delete u.resources.externalModules,delete u.moduleUrls,delete u.externalModules,delete u.modules;const b=function(e){if(!e)return{};const t={},n=G(e);if(n&&"object"==typeof n){const e=n.slider||{};"boolean"==typeof e.enabled?t.enabled=e.enabled:"boolean"==typeof n.sliderEnabled&&(t.enabled=n.sliderEnabled);let a=e.feedUrl||e.url||e.json||"";a||(a=n.sliderJson||n.sliderJSON||""),void 0!==a&&("string"!=typeof a&&(a=String(a)),t.url=a.trim())}if(void 0===t.enabled||void 0===t.url){const n=e.match(/UI_ChannelList\s*=\s*(['"]?)([01])\1/);void 0===t.enabled&&n&&(t.enabled="1"===n[2]);const a=e.match(/Channel_JSON\s*=\s*(['"`])([^'"`]*?)\1/);void 0===t.url&&a&&(t.url=a[2].trim())}return t}(d?.value||"");"boolean"==typeof b.enabled&&(u.slider.enabled=b.enabled,u.sliderEnabled=b.enabled),void 0!==b.url&&(u.slider.feedUrl=b.url||"",u.sliderJson=b.url||"");let h=!0;ie(l,u),h=!1,setTimeout(()=>{const e=q(F(u));J(l,e),R(l)},50);let g=!1;const w=l.querySelector("#btfw-theme-status");re(l,u,()=>{const e=se(l,u);O(u,e),te(l,u),g=!0,w&&(w.textContent="Changes pending. Click apply to sync with Channel JS/CSS.",w.dataset.variant="pending")}),setTimeout(()=>{P(l)?R(l):console.error("[theme-admin] Module container NOT found after panel init")},100);const y=l.querySelector("#btfw-theme-apply");y&&y.addEventListener("click",()=>{const t=se(l,u);O(u,t);const n=le(l,u,e,{mode:"manual"});n&&(g=!1,window.setTimeout(()=>{const t=function(e,t,n){const a=[];e&&a.push(e),a.push(document);const o=new Set;["#cs-jssubmit","#cs-csssubmit","button[name='save-js']","button[name='save-css']","button[data-action='save-js']","button[data-action='save-css']"].forEach(e=>{a.forEach(t=>{if(!t)return;const n=t.querySelector(e);if(n&&!o.has(n)&&"function"==typeof n.click)try{n.click(),o.add(n)}catch(e){}})});let r=o.size>0;const i=new Set;return t&&t.form&&i.add(t.form),n&&n.form&&i.add(n.form),i.forEach(e=>{if(e)try{"function"==typeof e.requestSubmit?(e.requestSubmit(),r=!0):"function"==typeof e.submit&&(e.submit(),r=!0)}catch(e){}}),r}(e,n.jsField,n.cssField);w&&(t?(w.textContent="Theme JS & CSS applied and submitted to CyTube.",w.dataset.variant="saved"):(w.textContent="Theme JS & CSS applied. Save channel settings to publish.",w.dataset.variant="idle"))},60))});new MutationObserver(()=>{(l.classList.contains("active")||"block"===l.style.display)&&w&&g&&(w.textContent="Changes pending. Click apply to sync with Channel JS/CSS.",w.dataset.variant="pending")}).observe(l,{attributes:!0,attributeFilter:["class","style"]});const v=d?.value||"",x=c?.value||"",S=v.includes(t)&&v.includes(n),_=x.includes(a)&&x.includes(o);let E=!S||!_;return m<s.version&&(u.version=s.version,E=!0),E?(g=!0,w&&(w.textContent="Theme config needs to be applied. Click Apply to sync with Channel JS/CSS.",w.dataset.variant="idle")):w&&!g&&(w.textContent="Theme settings loaded. No changes applied yet.",w.dataset.variant="idle"),l.dataset.initialized="1",!0}"undefined"==typeof window||window.__btfwModuleWatcherCleanupRegistered||(window.addEventListener("beforeunload",()=>{const e=Array.from(S);for(const t of e)D(t.container,t)}),window.__btfwModuleWatcherCleanupRegistered=!0);const ce="#channeloptions, #channelsettingsmodal, #channeloptionsmodal, .channel-settings-modal";function fe(e){e&&Y()&&(e.dataset.btfwThemeAdminBound?de(e):de(e)&&(e.dataset.btfwThemeAdminBound="1"))}function ue(){if(!Y())return;fe(document.querySelector(ce))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ue):ue();const me=(()=>{let e=!1;return function(){if(e)return;e=!0;const t=e=>{fe(e?.target?.closest?.(ce)||(e?.target&&e.target.matches?.(ce)?e.target:null))};document.addEventListener("show.bs.modal",t,!0),document.addEventListener("shown.bs.modal",t,!0)}})();return function(){if("undefined"==typeof window||"undefined"==typeof document)return;const e=()=>{try{const e=window.BTFW_THEME_ADMIN;e&&"object"==typeof e&&T(e)}catch(e){console.warn("[theme-admin] Failed to sync runtime theme config",e)}};e(),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",e,{once:!0})}(),me(),{name:"feature:channelThemeAdmin"}}),BTFW.define("feature:themeSettings",[],async()=>{const e=(e,t=document)=>t.querySelector(e),t=(e,t=document)=>Array.from(t.querySelectorAll(e)),n=await BTFW.init("util:motion"),a="btfw:chat:textSize",o="btfw:chat:avatars",r="btfw:chat:emoteSize",i="btfw:chat:gifAutoplay",s="btfw:chat:joinNotices",l="btfw:stack:compact",d="btfw:video:localsubs",c="btfw:billcast:enabled",f="btfw:layout:chatSide",u=(e,t)=>{try{const n=localStorage.getItem(e);return null==n?t:n}catch(e){return t}},m=(e,t)=>{try{localStorage.setItem(e,t)}catch(e){}},p="btfw:chat:ignore";function b(e){return(e||"").trim().replace(/^@+/,"")}function h(){try{const e=localStorage.getItem(p);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.map(e=>b(String(e))).filter(Boolean):[]}catch(e){return[]}}function g(e){try{localStorage.setItem(p,JSON.stringify(e))}catch(e){}}function w(t){const n=e("#chatwrap");if(!n)return;const a=Math.min(Math.max(Number(t)||14,10),20);n.style.setProperty("--btfw-chat-text",`${a}px`)}function y(e){const t="small"===e?100:"big"===e?170:130;document.documentElement.style.setProperty("--btfw-emote-size",`${t}px`),document.dispatchEvent(new CustomEvent("btfw:chat:emoteSizeChanged",{detail:{size:e,px:t}}))}function v(e){const t=!!e;document.documentElement.classList.toggle("btfw-compact-stack",t),E?.setCompactSpacing?E.setCompactSpacing(t):T().then(e=>{e?.setCompactSpacing&&e.setCompactSpacing(t)})}const x=new Map;function S(e){if(x.has(e))return x.get(e);const t=window.BTFW&&"function"==typeof BTFW.init?BTFW.init(e).catch(()=>null):Promise.resolve(null);return x.set(e,t),t}let _=null,E=null,k=null;function C(){return _?Promise.resolve(_):S("feature:chat-avatars").then(e=>(e&&(_=e),_||S("feature:chatAvatars").then(e=>(e&&(_=e),_))))}function T(){return E?Promise.resolve(E):S("feature:stack").then(e=>(e&&(E=e),E))}function A(){return k?Promise.resolve(k):S("feature:chat-ignore").then(e=>(e&&(k=e),k))}function N(){if(k?.list)try{const e=k.list();if(Array.isArray(e))return e.map(e=>b(String(e))).filter(Boolean)}catch(e){}return h()}function j(){let n=e("#btfw-theme-modal");if(n)return n;["#themesettings","#themeSettingsModal",".themesettings"].forEach(e=>t(e).forEach(e=>e.remove())),n=document.createElement("div"),n.id="btfw-theme-modal",n.className="modal",n.dataset.btfwModalState="closed",n.setAttribute("hidden",""),n.setAttribute("aria-hidden","true"),n.innerHTML='\n      <div class="modal-background"></div>\n      <div class="modal-card btfw-theme-modal-card">\n        <header class="modal-card-head">\n          <p class="modal-card-title">Theme Settings</p>\n          <button class="delete" aria-label="close"></button>\n        </header>\n        <section class="modal-card-body">\n          <div class="tabs btfw-ts-tabs is-small" id="btfw-ts-tabs">\n            <ul>\n              <li class="is-active" data-tab="general"><a>General</a></li>\n              <li data-tab="chat"><a>Chat</a></li>\n              <li data-tab="notifications"><a>Notifications</a></li>\n              <li data-tab="video"><a>Video</a></li>\n              <li data-tab="ignore"><a>Ignore</a></li>\n            </ul>\n          </div>\n\n          <div id="btfw-ts-panels">\n            \x3c!-- General --\x3e\n            <div class="btfw-ts-panel" data-tab="general" style="display:block;">\n              <div class="btfw-ts-grid">\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Stack layout</h3>\n                    <p>Give desktop stack modules a little more breathing room.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <button type="button" class="btfw-compact-stack-btn" id="btfw-compact-stack-toggle" aria-pressed="true">\n                      <span class="btfw-compact-stack-label">Compact stack</span>\n                      <span class="btfw-compact-stack-status">On</span>\n                    </button>\n                    <p class="btfw-help">Adds horizontal padding around <code>.btfw-stack-list</code> items whenever the desktop grid is active.</p>\n                  </div>\n                </section>\n\n              </div>\n            </div>\n\n            \x3c!-- Chat --\x3e\n            <div class="btfw-ts-panel" data-tab="chat" style="display:none;">\n              <div class="btfw-ts-grid">\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Avatars & text</h3>\n                    <p>Adjust density and readability for the chat column.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <div class="btfw-ts-control">\n                      <label class="btfw-input__label" for="btfw-avatars-mode">Avatar size</label>\n                      <div class="select is-small">\n                        <select id="btfw-avatars-mode">\n                          <option value="off">Off</option>\n                          <option value="small">Small</option>\n                          <option value="big">Big</option>\n                        </select>\n                      </div>\n                    </div>\n                    <div class="btfw-ts-control">\n                      <span class="btfw-input__label">Chat text size</span>\n                      <div class="control btfw-range-control">\n                        <input type="range" id="btfw-chat-textsize" min="10" max="20" step="1">\n                        <span class="btfw-range-value" id="btfw-chat-textsize-value">14px</span>\n                      </div>\n                      <p class="btfw-help">Set chat typography anywhere between 10&nbsp;px and 20&nbsp;px.</p>\n                    </div>\n                  </div>\n                </section>\n\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Media</h3>\n                    <p>Control sticker and GIF behaviour for the chat experience.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <div class="btfw-ts-control">\n                      <label class="btfw-input__label" for="btfw-emote-size">Emote & GIF size</label>\n                      <div class="select is-small">\n                        <select id="btfw-emote-size">\n                          <option value="small">Small (100100)</option>\n                          <option value="medium">Medium (130130)</option>\n                          <option value="big">Big (170170)</option>\n                        </select>\n                      </div>\n                      <p class="btfw-help">Applies to elements with <code>.channel-emote</code> and the GIF picker.</p>\n                    </div>\n                    <label class="checkbox btfw-checkbox">\n                      <input type="checkbox" id="btfw-gif-autoplay"> <span>Autoplay GIFs in chat (otherwise play on hover)</span>\n                    </label>\n                  </div>\n                </section>\n\n              </div>\n            </div>\n\n            \x3c!-- Notifications --\x3e\n            <div class="btfw-ts-panel" data-tab="notifications" style="display:none;">\n              <div class="btfw-ts-grid">\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Join alerts</h3>\n                    <p>Decide whether to show join popups for new users.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <label class="checkbox btfw-checkbox">\n                      <input type="checkbox" id="btfw-chat-join-notices"> <span>Show notifications when users join</span>\n                    </label>\n                    <p class="btfw-help">Affects the Joined popups triggered by users entering the channel.</p>\n                  </div>\n                </section>\n\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Notification sounds</h3>\n                    <p>Pick custom audio cues for channel activity.</p>\n                  </header>\n                  <div class="btfw-ts-card__body" id="btfw-notify-sounds-body">\n                    <p class="btfw-help">Open this panel to configure alert tones for joins, mentions, polls, and new videos.</p>\n                  </div>\n                </section>\n              </div>\n            </div>\n\n            \x3c!-- Video --\x3e\n            <div class="btfw-ts-panel" data-tab="video" style="display:none;">\n              <div class="btfw-ts-grid">\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Layout</h3>\n                    <p>Choose how the desktop layout positions chat and video.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <div class="btfw-ts-control">\n                      <label class="btfw-input__label" for="btfw-chat-side">Layout mode</label>\n                      <div class="select is-small">\n                        <select id="btfw-chat-side">\n                          <option value="right">Video left, chat right</option>\n                          <option value="left">Chat left, video right</option>\n                        </select>\n                      </div>\n                    </div>\n                    <p class="btfw-help">Mobile screens automatically collapse into a stacked layout.</p>\n                  </div>\n                </section>\n\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Playback tools</h3>\n                    <p>Toggle experimental features for the HTML5 player.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <label class="checkbox btfw-checkbox">\n                      <input type="checkbox" id="btfw-billcast-toggle" checked> <span>Enable Billcast (Chromecast sender)</span>\n                    </label>\n                    <label class="checkbox btfw-checkbox">\n                      <input type="checkbox" id="btfw-localsubs-toggle"> <span>Show the Local Subtitles button</span>\n                    </label>\n                    <p class="btfw-help">Allows viewers to load local <code>.vtt</code> or <code>.srt</code> caption files.</p>\n                  </div>\n                </section>\n              </div>\n            </div>\n\n            \x3c!-- Ignore --\x3e\n            <div class="btfw-ts-panel" data-tab="ignore" style="display:none;">\n              <div class="btfw-ts-grid">\n                <section class="btfw-ts-card">\n                  <header class="btfw-ts-card__header">\n                    <h3>Ignored users</h3>\n                    <p>Hide messages from specific usernames. Changes apply instantly.</p>\n                  </header>\n                  <div class="btfw-ts-card__body">\n                    <form class="btfw-ignore-form" id="btfw-ignore-form">\n                      <div class="field has-addons">\n                        <div class="control is-expanded">\n                          <input class="input is-small" id="btfw-ignore-input" type="text" placeholder="Enter username">\n                        </div>\n                        <div class="control">\n                          <button class="button is-link is-small" type="submit">Add</button>\n                        </div>\n                      </div>\n                    </form>\n                    <div class="btfw-ignore-list" id="btfw-ignore-list" aria-live="polite"></div>\n                  </div>\n                </section>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <footer class="modal-card-foot">\n          <button class="button is-link" id="btfw-ts-apply">Apply</button>\n          <button class="button" id="btfw-ts-close">Close</button>\n        </footer>\n      </div>\n    ',document.body.appendChild(n),e(".modal-background",n).addEventListener("click",I),e(".delete",n).addEventListener("click",I),e("#btfw-ts-close",n).addEventListener("click",I),e("#btfw-ts-tabs ul",n).addEventListener("click",e=>{const a=e.target.closest("li[data-tab]");if(!a)return;t("#btfw-ts-tabs li",n).forEach(e=>e.classList.toggle("is-active",e===a));const o=a.getAttribute("data-tab");t("#btfw-ts-panels .btfw-ts-panel",n).forEach(e=>e.style.display=e.dataset.tab===o?"block":"none")}),e("#btfw-ts-apply",n).addEventListener("click",L);const a=e("#btfw-chat-textsize",n),o=e("#btfw-chat-textsize-value",n);if(a&&o){const e=e=>{o.textContent=`${e}px`};a.addEventListener("input",()=>e(a.value||"14")),e(a.value||"14")}const r=e("#btfw-compact-stack-toggle",n);if(r&&!r._btfwSync){const e=r.querySelector(".btfw-compact-stack-status"),t=t=>{const n=!!t;r.setAttribute("aria-pressed",n?"true":"false"),r.classList.toggle("is-active",n),e&&(e.textContent=n?"On":"Off"),r.dataset.state=n?"on":"off"};r.addEventListener("click",e=>{e.preventDefault();const n="true"!==r.getAttribute("aria-pressed");t(n)}),r._btfwSync=t}document.addEventListener("btfw:openThemeSettings",M);const i=e("#btfw-ignore-list",n),s=e("#btfw-ignore-form",n),l=e("#btfw-ignore-input",n),d=()=>{if(!i)return;const e=N();if(i.innerHTML="",!e.length){const e=document.createElement("p");return e.className="btfw-help",e.textContent="No ignored users yet.",void i.appendChild(e)}const t=document.createElement("ul");t.className="btfw-ignore-items",e.slice().sort((e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"})).forEach(e=>{const n=document.createElement("li");n.className="btfw-ignore-item";const a=document.createElement("span");a.className="btfw-ignore-name",a.textContent=e;const o=document.createElement("button");o.type="button",o.className="button is-small is-light",o.setAttribute("data-ignore-remove",e),o.textContent="Remove",n.appendChild(a),n.appendChild(o),t.appendChild(n)}),i.appendChild(t)};return s&&!s._btfwIgnoreBound&&(s._btfwIgnoreBound=!0,s.addEventListener("submit",e=>{e.preventDefault();const t=b(l?.value||"");if(!t)return;(function(e){const t=b(e);if(!t)return!1;const n=t.toLowerCase();if(new Set(N().map(e=>e.toLowerCase())).has(n))return!1;if(k?.add)try{k.add(t)}catch(e){}else{const e=h();e.push(n),g(e),A().then(e=>{try{e?.add?.(t)}catch(e){}})}return!0})(t)&&l&&(l.value=""),d()})),i&&!i._btfwIgnoreBound&&(i._btfwIgnoreBound=!0,i.addEventListener("click",e=>{const t=e.target?.closest?.("[data-ignore-remove]");if(!t)return;(function(e){const t=b(e);if(!t)return!1;const n=t.toLowerCase();if(!N().some(e=>e.toLowerCase()===n))return!1;if(k?.remove)try{k.remove(t)}catch(e){}else g(h().filter(e=>e.toLowerCase()!==n)),A().then(e=>{try{e?.remove?.(t)}catch(e){}});return!0})(t.getAttribute("data-ignore-remove")||"")&&d()})),n._btfwRenderIgnoreList=d,n}function L(){const t=e("#btfw-theme-modal");if(!t)return;const n=e("#btfw-avatars-mode",t)?.value||"big",u=e("#btfw-chat-textsize",t)?.value||"14",p=e("#btfw-emote-size",t)?.value||"medium",b=e("#btfw-gif-autoplay",t)?.checked,h=e("#btfw-chat-join-notices",t)?.checked,g=e("#btfw-compact-stack-toggle",t),x=!g||"true"===g.getAttribute("aria-pressed"),S=e("#btfw-localsubs-toggle",t)?.checked,E=e("#btfw-billcast-toggle",t)?.checked,k=e("#btfw-chat-side",t)?.value||"right";m(o,n),m(a,u),m(r,p),m(i,b?"1":"0"),m(s,h?"1":"0"),m(l,x?"1":"0"),m(d,S?"1":"0"),m(c,E?"1":"0"),m(f,k),_?.setMode?_.setMode(n):C().then(e=>{e?.setMode&&e.setMode(n)}),w(parseInt(u,10)),y(p),v(x),document.dispatchEvent(new CustomEvent("btfw:chat:gifAutoplayChanged",{detail:{autoplay:!!b}})),document.dispatchEvent(new CustomEvent("btfw:chat:joinNoticesChanged",{detail:{enabled:!!h}})),document.dispatchEvent(new CustomEvent("btfw:stack:compactChanged",{detail:{enabled:!!x}})),document.dispatchEvent(new CustomEvent("btfw:video:localsubs:changed",{detail:{enabled:!!S}})),document.dispatchEvent(new CustomEvent("btfw:layout:chatSideChanged",{detail:{side:k}})),document.dispatchEvent(new CustomEvent("btfw:themeSettings:apply",{detail:{values:{avatarsMode:n,chatTextPx:parseInt(u,10),emoteSize:p,gifAutoplay:!!b,compactStack:!!x,localSubs:!!S,billcastEnabled:!!E,joinNotices:!!h,chatSide:k}}}))}function M(){const t=j(),m=e("#btfw-avatars-mode",t),p=u(o,"big"),b=_?.getMode?_.getMode():p;m&&(m.value=["off","small","big"].includes(b)?b:"big"),C().then(e=>{if(e?.getMode&&m){const t=e.getMode();m.value=["off","small","big"].includes(t)?t:m.value}});const h=u(a,"14"),g=e("#btfw-chat-textsize");g&&(g.value=h);const w=e("#btfw-chat-textsize-value");w&&(w.textContent=`${h}px`),e("#btfw-emote-size").value=u(r,"medium"),e("#btfw-gif-autoplay").checked="1"===u(i,"1"),e("#btfw-chat-join-notices").checked="1"===u(s,"1"),e("#btfw-localsubs-toggle").checked="1"===u(d,"1");const y=e("#btfw-billcast-toggle");y&&(y.checked="1"===u(c,"1"));const v="1"===u(l,"1"),x=e("#btfw-compact-stack-toggle",t);if(x?._btfwSync)x._btfwSync(v);else if(x){x.setAttribute("aria-pressed",v?"true":"false");const e=x.querySelector(".btfw-compact-stack-status");e&&(e.textContent=v?"On":"Off")}const S=e("#btfw-chat-side",t),E=u(f,"right");S&&(S.value=["left","right"].includes(E)?E:"right"),"function"==typeof t._btfwRenderIgnoreList&&t._btfwRenderIgnoreList(),n.openModal(t),document.dispatchEvent(new CustomEvent("btfw:themeSettings:open"))}function I(){const t=e("#btfw-theme-modal");t&&n.closeModal(t)}C(),T(),A();let U=!1;function O(){U||(U=!0,document.addEventListener("click",e=>{const t=e.target?.closest?.("#btfw-theme-btn-chat, #btfw-theme-btn-nav, .btfw-theme-open");t&&(e.preventDefault(),M())}))}function B(e=document.getElementById("useroptions")){if(!e)return;const t=e.querySelector("#us-general");if(t&&!t._btfwDecorated){t._btfwDecorated=!0,t.classList.add("btfw-useroptions-pane");Array.from(t.querySelectorAll("h3, h4, .section-header, legend")).forEach(e=>{e.textContent.toLowerCase().includes("general preferences")&&(e.style.display="none")});Array.from(t.querySelectorAll("p, .help-block, .text-muted")).forEach(e=>{const t=e.textContent.toLowerCase();(t.includes("changing layouts")||t.includes("require refreshing"))&&(e.style.display="none")});["#us-theme","#us-layout","#us-no-channelcss","#us-no-channeljs"].forEach(e=>{const n=t.querySelector(e);if(n){const e=n.closest(".form-group, .control-group, .checkbox, label, div");e&&(e.style.display="none")}});Array.from(t.querySelectorAll("label")).forEach(e=>{const t=e.textContent.toLowerCase();if(t.includes("theme")||t.includes("layout")||t.includes("ignore channel css")||t.includes("ignore channel javascript")){e.style.display="none";const t=e.closest(".form-group, .control-group, .checkbox, div");t&&(t.style.display="none")}});Array.from(t.querySelectorAll('input[type="checkbox"]')).forEach(e=>{const t=e.name||e.id||"";if(t.includes("channelcss")||t.includes("channeljs")){const t=e.closest(".form-group, .control-group, .checkbox, label, div");t&&(t.style.display="none")}});Array.from(t.querySelectorAll("select")).forEach(e=>{const t=e.name||e.id||"";if(t.includes("theme")||t.includes("layout")){const t=e.closest(".form-group, .control-group, div");t&&(t.style.display="none")}});const e=document.createElement("div");e.className="btfw-useroptions-about",e.innerHTML='\n      <div class="btfw-useroptions-hero">\n        <span class="btfw-useroptions-badge">BillTube3</span>\n        <h4>Made by Bill</h4>\n        <p>BillTube3 keeps the entire channel aligned with a unified visual language. Theme and layout settings are managed by the channel to ensure a consistent experience.</p>\n      </div>\n      <div class="btfw-useroptions-panels">\n        <article class="btfw-useroptions-panel">\n          <h5>New features!</h5>\n          <p>Native mobile theme, dynamic chromecast support, Tenor and Giphy for more emote variety.</p>\n        </article>\n        <article class="btfw-useroptions-panel">\n          <h5>Need a tweak?</h5>\n          <p>Share feedback in chat or ping Bill directly on Discord. Adjustments roll out globally after testing in the Channel Theme Toolkit.</p>\n        </article>\n      </div>\n    ',t.insertBefore(e,t.firstChild)}}let F=!1;function q(){w(parseInt(u(a,"14"),10)),y(u(r,"medium")),v("1"===u(l,"1")),O(),B(),F||(F=!0,document.addEventListener("show.bs.modal",e=>{const t=e?.target?.closest?.("#useroptions")||("useroptions"===e?.target?.id?e.target:null);t&&B(t)},!0))}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",q):q(),{name:"feature:themeSettings",open:M,close:I,wireOpeners:O}}),BTFW.define("feature:motd-editor",[],async()=>{const e=(e,t=document)=>t.querySelector(e),t=(e,t=document)=>Array.from(t.querySelectorAll(e)),n=await BTFW.init("util:motion"),a="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-lite.min.css",o="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-lite.min.js",r="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js";function i(e,n="stylesheet"){return new Promise((a,o)=>{if("stylesheet"===n&&t(`link[href="${e}"]`).length)return a();if("script"===n&&t(`script[src="${e}"]`).length)return a();const r=document.createElement("script"===n?"script":"link");"script"===n?(r.src=e,r.async=!1,r.onload=a,r.onerror=o):(r.rel="stylesheet",r.href=e,r.onload=a,r.onerror=o),document.head.appendChild(r)})}async function s(){const t=function(){const t=e("#cs-motdtext");if(t&&t.value&&t.value.trim())return t.value;const n=e("#motd");if(n&&n.innerHTML&&n.innerHTML.trim())return n.innerHTML;const a=e("#motdwrap");return a&&a.innerHTML&&a.innerHTML.trim()?a.innerHTML:""}(),s=function(){const t=e("#btfw-motd-modal");t&&t.remove();const a=document.createElement("div");a.id="btfw-motd-modal",a.className="modal",a.dataset.btfwModalState="closed",a.setAttribute("hidden",""),a.setAttribute("aria-hidden","true"),a.innerHTML='\n      <div class="modal-background"></div>\n      <div class="modal-card btfw-modal">\n        <header class="modal-card-head">\n          <p class="modal-card-title">Edit MOTD</p>\n          <button class="delete" aria-label="close"></button>\n        </header>\n        <section class="modal-card-body">\n          <div id="btfw-motd-editor"></div>\n        </section>\n      <footer class="modal-card-foot">\n        <button class="button is-link" id="btfw-motd-save">Save</button>\n        <button class="button" id="btfw-motd-cancel">Cancel</button>\n      </footer>\n    </div>',document.body.appendChild(a);const o=()=>n.closeModal(a);return e(".modal-background",a).addEventListener("click",o),e(".delete",a).addEventListener("click",o),e("#btfw-motd-cancel",a).addEventListener("click",o),a}();try{window.jQuery||await i(r,"script"),await i(a,"stylesheet"),await i(o,"script")}catch(a){console.warn("[motd-editor] Summernote load failed",a);const o=e("#btfw-motd-editor",s);return o&&(o.innerHTML=`<textarea class="textarea" style="height:400px; font-family:monospace;">${t}</textarea>`),void n.openModal(s)}const l=e("#btfw-motd-editor",s);if(!l)return void console.error("[motd-editor] Editor host not found");window.jQuery&&window.jQuery.fn.summernote?jQuery(l).summernote({height:400,toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video"]],["view",["codeview","help"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],fontNames:["Arial","Comic Sans MS","Courier New","Helvetica","Impact","Tahoma","Times New Roman","Verdana","Roboto","Open Sans"],fontSizes:["8","10","12","14","16","18","20","24","28","32","36","48"],placeholder:"Enter your message of the day here...",callbacks:{onInit:function(){jQuery(l).summernote("code",t),console.log("[motd-editor] Summernote initialized")}}}):l.innerHTML=`<textarea class="textarea" style="height:400px;">${t}</textarea>`;const d=e("#btfw-motd-save",s);d&&(d.onclick=()=>{const t=window.jQuery&&window.jQuery.fn.summernote?jQuery(l).summernote("code"):e("#btfw-motd-editor textarea")?.value||"";console.log("[motd-editor] Saving MOTD, length:",t.length);try{window.socket?.emit&&socket.emit("setMotd",{motd:t})}catch(e){console.warn("[motd-editor] setMotd emit failed",e)}const a=e("#motd");a&&(a.innerHTML=t);const o=e("#cs-motdtext");o&&(o.value=t),window.jQuery&&window.jQuery.fn.summernote&&jQuery(l).summernote("destroy"),n.closeModal(s)}),n.openModal(s)}async function l(){const t=e("#cs-motdtext");if(!t||t.dataset.btfwSummernoteEnhanced)return;t.dataset.btfwSummernoteEnhanced="true";try{window.jQuery||await i(r,"script"),await i(a,"stylesheet"),await i(o,"script")}catch(e){return void console.warn("[motd-editor] Summernote load failed for channel settings",e)}if(!window.jQuery||!window.jQuery.fn.summernote)return;t.value;jQuery(t).summernote({height:350,toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video"]],["view",["codeview"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],fontNames:["Arial","Comic Sans MS","Courier New","Helvetica","Impact","Tahoma","Times New Roman","Verdana","Roboto","Open Sans"],fontSizes:["8","10","12","14","16","18","20","24","28","32","36","48"],callbacks:{onChange:function(e){t.value=e}}}),console.log("[motd-editor] Channel settings MOTD enhanced with Summernote")}function d(){const t=document.getElementById("btfw-motd-editbtn"),n=t?t.closest(".btfw-motd-editrow"):null;if(!function(){try{if("function"==typeof window.hasPermission&&(window.hasPermission("motdedit")||window.hasPermission("editMotd")||window.hasPermission("motd")))return!0;const e=window.CLIENT||null;if(e?.hasPermission&&(e.hasPermission("motdedit")||e.hasPermission("editMotd")||e.hasPermission("motd")))return!0;if(e&&void 0!==e.rank){const t=0|e.rank,n=window.RANK||window.Ranks||{},a=[n.moderator,n.mod,n.admin,n.administrator].find(e=>"number"==typeof e);return"number"==typeof a?t>=a:t>=2}}catch(e){}return!1}())return void(n&&n.remove());const a=e("#motdwrap")||e("#motd")?.closest(".well")||e("#btfw-leftpad"),o=a?.parentNode;if(!a||!o)return;let r=n;if(r||(r=document.createElement("div"),r.innerHTML='<button id="btfw-motd-editbtn" class="button is-small is-link"><i class="fa fa-pencil"></i> Edit MOTD</button>'),r.classList.add("buttons","is-right","btfw-motd-editrow"),!r.querySelector("#btfw-motd-editbtn")){const e=document.createElement("button");e.id="btfw-motd-editbtn",e.className="button is-small is-link",e.innerHTML='<i class="fa fa-pencil"></i> Edit MOTD',r.appendChild(e)}r.parentNode===o&&r.previousElementSibling===a||o.insertBefore(r,a.nextSibling);const i=r.querySelector("#btfw-motd-editbtn");i&&!i._btfwMotdBound&&(i._btfwMotdBound=!0,i.addEventListener("click",s))}function c(){d();new MutationObserver(()=>d()).observe(document.body,{childList:!0,subtree:!0}),new MutationObserver(()=>{const t=e("#channeloptions, #channelsettingsmodal, #channeloptionsmodal");t&&"none"!==t.style.display&&!t.classList.contains("hidden")&&setTimeout(()=>l(),150)}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),document.addEventListener("show.bs.modal",e=>{const t=e?.target;!t||"channeloptions"!==t.id&&"channelsettingsmodal"!==t.id&&"channeloptionsmodal"!==t.id||setTimeout(()=>l(),150)},!0),document.addEventListener("shown.bs.modal",e=>{const t=e?.target;!t||"channeloptions"!==t.id&&"channelsettingsmodal"!==t.id&&"channeloptionsmodal"!==t.id||setTimeout(()=>l(),150)},!0)}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),{name:"feature:motd-editor",openEditor:s}});